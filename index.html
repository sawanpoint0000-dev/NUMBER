<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HACKER PANEL 1.0</title>

<style>
body { font-family: Arial; background: #1e1e1e; color: #e0e0e0; padding: 15px; max-width: 600px; margin: auto; }
h1 { text-align: center; color: #4ecdc4; font-size: 24px; margin-bottom: 10px; }
#toggleBtn { width: 100%; padding: 15px; font-size: 18px; font-weight: bold; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; margin-bottom: 10px; }
#toggleBtn.off { background: #dc3545; }
#status { padding: 12px; margin-bottom: 10px; border-radius: 6px; text-align: center; font-weight: bold; background: #2d2d2d; }
.error { background: #442222; color: #ff6b6b; }
.buying { background: #1a3a3a; color: #4ecdc4; }
#numbers { display: flex; flex-direction: column; gap: 8px; }
.numbox { display: flex; align-items: center; background: #2a2a2a; padding: 10px; border-radius: 8px; border: 1px solid #444; position: relative; }
.phone10 { flex: 1; font-size: 18px; font-weight: bold; cursor: pointer; }
.copybtn { padding: 6px 12px; margin: 0 8px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; }
.copybtn:hover { background: #0056b3; }
.otp { padding: 6px 12px; background: #1a1a1a; border: 1px solid #444; border-radius: 4px; min-width: 100px; text-align: center; font-size: 14px; font-weight: bold; }
.timer { position: absolute; top: 4px; right: 8px; font-size: 12px; color: #ff9800; background: rgba(0,0,0,0.6); padding: 2px 6px; border-radius: 4px; font-family: monospace; }
.success { background: #28a745 !important; color: white !important; }
</style>
</head>

<body>

<h1>HACKER PANEL 1.0</h1>
<button id="toggleBtn">ON Karo</button>
<div id="status">Off hai â†’ ON dabao</div>
<div id="numbers"></div>

<script>
const API_KEY = "be0f90185132287cb7b00f6790d7f7bb";
const BASE_URL = "https://api.grizzlysms.com/stubs/handler_api.php";
const SERVICE = "swr";
const COUNTRY = "22";
const MAX_PRICE = "80";

const STATE_KEY = 'hp_isOn';
const USED_KEY = 'hp_used_numbers';
const ACTIVE_KEY = 'hp_active_numbers';

let isOn = localStorage.getItem(STATE_KEY) === 'true';
let usedNumbers = JSON.parse(localStorage.getItem(USED_KEY) || '[]');
let activeNumbers = JSON.parse(localStorage.getItem(ACTIVE_KEY) || '[]');

const toggleBtn = document.getElementById('toggleBtn');
const statusDiv = document.getElementById('status');
const numbersDiv = document.getElementById('numbers');

function updateUI() {
    toggleBtn.textContent = isOn ? 'OFF Karo' : 'ON Karo';
    toggleBtn.classList.toggle('off', !isOn);
    statusDiv.textContent = isOn ? 'Auto buy fast mode...' : 'Off hai';
}

toggleBtn.onclick = () => {
    isOn = !isOn;
    localStorage.setItem(STATE_KEY, isOn);
    updateUI();
    if (isOn) start();
    else clearInterval(interval);
};

function saveActive() {
    localStorage.setItem(ACTIVE_KEY, JSON.stringify(activeNumbers));
}

function isValid(phone) {
    if (!phone || phone.length !== 12) return false;
    if (!phone.startsWith("91")) return false;
    if (!/^\d{12}$/.test(phone)) return false;
    if (usedNumbers.includes(phone)) return false;

    usedNumbers.push(phone);
    localStorage.setItem(USED_KEY, JSON.stringify(usedNumbers));
    return true;
}

function cleanStorage() {
    const now = Date.now();
    activeNumbers = activeNumbers.filter(item =>
        item.phone &&
        item.phone.length === 12 &&
        item.phone.startsWith("91") &&
        /^\d{12}$/.test(item.phone) &&
        (now - item.startTime) < 300000
    );
    saveActive();
}

function renderSaved() {
    cleanStorage();
    numbersDiv.innerHTML = '';

    // NEWEST FIRST
    activeNumbers
        .sort((a,b)=> b.startTime - a.startTime)
        .forEach(item => {
            const box = createBox(item.phone.slice(2), item.id, item.startTime, item.otp);
            numbersDiv.appendChild(box);
            startTimer(box, item.startTime);
            if (!item.otp) startPolling(box, item.id);
        });
}

function createBox(num10, id, startTime, otp=null) {
    const box = document.createElement('div');
    box.className = 'numbox';
    box.dataset.id = id;

    box.innerHTML = `
        <div class="phone10">${num10}</div>
        <button class="copybtn">Copy</button>
        <div class="otp">${otp ? otp : 'OTP wait...'}</div>
        <div class="timer">05:00</div>
    `;

    box.querySelector('.phone10').onclick = () => navigator.clipboard.writeText(num10);
    box.querySelector('.copybtn').onclick = () => navigator.clipboard.writeText(num10);

    if (otp) box.querySelector('.otp').classList.add('success');

    return box;
}

function startTimer(box, startTime) {
    let remaining = 300 - Math.floor((Date.now() - startTime) / 1000);
    const timer = box.querySelector('.timer');

    const int = setInterval(() => {
        remaining--;
        const m = String(Math.floor(remaining/60)).padStart(2,'0');
        const s = String(remaining%60).padStart(2,'0');
        timer.textContent = `${m}:${s}`;

        if (remaining <= 0) {
            clearInterval(int);
            box.remove();
            activeNumbers = activeNumbers.filter(i => i.id !== box.dataset.id);
            saveActive();
        }
    },1000);
}

function startPolling(box, id) {
    const otpEl = box.querySelector('.otp');

    const poll = setInterval(async () => {
        const q = new URLSearchParams({ api_key: API_KEY, action: 'getStatus', id });
        try {
            const r = await fetch(BASE_URL + '?' + q);
            const t = (await r.text()).trim();
            if (t.startsWith('STATUS_OK')) {
                const code = t.split(':')[1];
                otpEl.textContent = code;
                otpEl.classList.add('success');
                clearInterval(poll);

                const item = activeNumbers.find(i => i.id === id);
                if (item) { item.otp = code; saveActive(); }
            }
        } catch {}
    },2000);
}

let interval;

async function fetchNumber() {
    if (!isOn) return;

    const p = new URLSearchParams({
        api_key: API_KEY,
        action: 'getNumber',
        service: SERVICE,
        country: COUNTRY,
        maxPrice: MAX_PRICE
    });

    try {
        const res = await fetch(BASE_URL + '?' + p);
        const txt = (await res.text()).trim();

        if (txt.startsWith('ACCESS_NUMBER')) {
            const [_, id, full] = txt.split(':');
            if (!isValid(full)) return;

            const startTime = Date.now();
            const item = { id, phone: full, startTime, otp:null };

            activeNumbers.unshift(item); // ðŸ”¥ ALWAYS TOP
            saveActive();

            const box = createBox(full.slice(2), id, startTime);
            numbersDiv.prepend(box); // ðŸ”¥ ALWAYS TOP
            startTimer(box, startTime);
            startPolling(box, id);
        }
    } catch {}
}

function start() {
    fetchNumber();
    interval = setInterval(fetchNumber,1000);
}

updateUI();
renderSaved();
if (isOn) start();
</script>

</body>
</html>
